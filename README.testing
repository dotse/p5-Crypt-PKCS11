apt-get install build-essential libxml2-dev libsqlite3-dev sqlite3 libbotan1.10-dev libssl-dev autoconf automake libtool libcunit1-dev libxml2-utils libcppunit-dev wget sshfs

wget --no-check-certificate http://www.opendnssec.org/files/source/softhsm-1.3.7.tar.gz
wget --no-check-certificate http://www.opendnssec.org/files/source/testing/softhsm-2.0.0b2.tar.gz

tar zxvf softhsm-1.3.7.tar.gz 
cd softhsm-1.3.7
./configure --with-botan=/usr
make && make install

tar zxvf softhsm-2.0.0b2.tar.gz 
cd softhsm-2.0.0b2
./configure --disable-non-paged-memory
make && make install

patch MutexFactory.cpp <<EOF
--- MutexFactory.cpp.orig	2015-01-13 07:44:20.632147042 +0000
+++ MutexFactory.cpp	2015-01-13 07:44:44.476265281 +0000
@@ -43,7 +43,7 @@
 // Constructor
 Mutex::Mutex()
 {
-	isValid = (MutexFactory::i()->createMutex(&handle) == CKR_OK);	
+	isValid = (MutexFactory::i()->CreateMutex(&handle) == CKR_OK);	
 }
 
 // Destructor
@@ -51,14 +51,14 @@
 {
 	if (isValid)
 	{
-		MutexFactory::i()->destroyMutex(handle);
+		MutexFactory::i()->DestroyMutex(handle);
 	}
 }
 
 // Lock the mutex
 bool Mutex::lock()
 {
-	return (isValid && (MutexFactory::i()->lockMutex(handle) == CKR_OK));
+	return (isValid && (MutexFactory::i()->LockMutex(handle) == CKR_OK));
 }
 	 
 // Unlock the mutex
@@ -66,7 +66,7 @@
 {
 	if (isValid) 
 	{
-		MutexFactory::i()->unlockMutex(handle);
+		MutexFactory::i()->UnlockMutex(handle);
 	}
 }
 
EOF
